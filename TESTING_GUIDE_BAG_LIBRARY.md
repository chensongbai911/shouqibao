# 🧪 受气包库快速测试指南

## 快速开始

### Step 1: 确认文件已更新
```bash
# 验证新建文件
miniprogram/utils/bag_models.js          ✅
miniprogram/pages/index/BAG_LIBRARY_GUIDE.md  ✅

# 验证已修改文件
miniprogram/utils/bag_3d.js              ✅
miniprogram/pages/index/index.wxml       ✅
miniprogram/pages/index/index.js         ✅
miniprogram/pages/index/index.wxss       ✅
```

### Step 2: 在微信开发者工具中打开项目
1. 打开微信开发者工具
2. 选择项目目录：`d:\shouqibao\miniprogram`
3. 点击"编译"按钮

### Step 3: 测试基础功能

#### ✅ 测试1：启动游戏
- 预期：页面正常加载
- 验证：底部菜单栏显示6个按钮（新增"🎒 包库"）
- 操作：无需操作，游戏自动加载

#### ✅ 测试2：打开包库
- 预期：包库面板从底部滑上
- 验证：
  - 显示"🎒 包库"标题
  - 显示"选择你喜欢的包样式"副标题
  - 显示关闭按钮✕
  - 显示2列网格布局
- 操作：点击底部菜单中的"🎒 包库"按钮

#### ✅ 测试3：浏览所有包
- 预期：显示10个包模型
- 验证：
  1. 经典圆形包 - 普通稀有度
  2. Q弹果冻包 - 普通稀有度
  3. 刺猬包 - 优秀稀有度
  4. 方块包 - 优秀稀有度
  5. 星形包 - 稀有稀有度
  6. 水果包 - 稀有稀有度
  7. 毛绒包 - 史诗稀有度
  8. 结晶包 - 史诗稀有度
  9. 火焰包 - 传说稀有度
  10. 金属包 - 传说稀有度
- 操作：向下滚动查看所有包

#### ✅ 测试4：3D预览
- 预期：每个包都有独特的3D外形
- 验证：点击不同的包项，确认预览显示不同的形状
- 操作：逐个点击不同的包

#### ✅ 测试5：切换包模型
- 预期：点击后立即切换到该包
- 验证：
  - 主页上显示新的包模型
  - 被选中的包项有蓝青色发光边框
  - 左上角有选中勾选标记✓
  - 提示"成功切换包款"
- 操作：
  1. 点击"Q弹果冻包"
  2. 等待提示消失
  3. 再点击"火焰包"
  4. 观察主页上的包变化

#### ✅ 测试6：关闭包库
- 预期：包库面板关闭
- 验证：
  - 面板滑下去
  - 返回游戏主页
- 操作：
  1. 点击面板关闭按钮✕
  2. 或点击背景蒙层
  3. 或点击底部菜单的其他按钮

#### ✅ 测试7：表情系统兼容性
- 预期：所有包都能显示正确的表情
- 验证：点击包，观察其表情变化
- 操作：
  1. 选择任意一个包
  2. 点击该包进行"打击"
  3. 观察眼睛是否眯起、嘴巴是否变形

#### ✅ 测试8：伤害飘字
- 预期：伤害数字正常显示在包上方
- 验证：
  - 伤害文字能正常显示
  - 伤害文字动画流畅
  - 暴击时文字变大变红
- 操作：
  1. 选择不同的包
  2. 点击多次产生伤害
  3. 观察伤害飘字

#### ✅ 测试9：深色模式
- 预期：深色模式下包库显示正常
- 验证：
  - 文字高对比度（纯白）
  - 选中状态为蓝青色
  - 稀有度标签色彩合适
- 操作：
  1. 点击左上角太阳/月亮按钮切换深色模式
  2. 打开包库
  3. 选择一个包
  4. 确认显示无问题

#### ✅ 测试10：数据持久化
- 预期：用户选择被保存
- 验证：关闭游戏后重新打开，包仍为之前选择的
- 操作：
  1. 选择"星形包"
  2. 关闭游戏（直接关闭标签页或刷新F5）
  3. 重新打开游戏
  4. 验证主页显示的是"星形包"

## 高级测试

### 性能测试

#### 测试11：包切换性能
- 预期：快速连续切换不卡顿
- 验证：帧率保持60fps
- 操作：
  ```
  快速点击不同的包（连续点击5-10次）
  打开浏览器开发者工具查看Performance
  ```

#### 测试12：内存检查
- 预期：切换包后内存不泄漏
- 验证：
  - 内存占用稳定
  - 切换20次后内存未显著增加
- 操作：
  ```
  打开浏览器开发者工具Memory标签
  拍摄初始快照
  快速切换10-20次包
  拍摄最终快照
  对比大小
  ```

#### 测试13：并发操作
- 预期：多个操作同时发生不出错
- 验证：
  - 正在显示伤害时切换包不出错
  - 表情变化时切换包不出错
- 操作：
  1. 快速点击包产生伤害
  2. 立即切换包模型
  3. 观察是否卡顿或出错

### 兼容性测试

#### 测试14：不同屏幕尺寸
- 预期：响应式布局适配
- 验证：
  - 手机竖屏：2列网格正常显示
  - 平板横屏：4列网格或更多
  - 小屏幕：不出现布局混乱
- 操作：
  ```
  按F12打开开发者工具
  点击设备工具栏
  选择不同设备尺寸测试
  ```

#### 测试15：浏览器兼容性
- 预期：各种浏览器都能正常显示
- 验证：
  - Chrome 正常 ✅
  - Firefox 正常 ✅
  - Safari 正常 ✅
  - 微信内置浏览器 正常 ✅
- 操作：在不同浏览器中打开

## 故障排查

### ❌ 问题1：包库按钮不显示
**症状**：底部菜单中没有"🎒 包库"按钮
**排查步骤**：
1. 检查 `index.wxml` 是否已更新
2. 检查是否有编译错误
3. 重新编译：Ctrl+B

### ❌ 问题2：打开包库出错
**症状**：点击按钮后没有反应或出现错误
**排查步骤**：
1. 打开浏览器控制台 (F12)
2. 查看是否有JavaScript错误
3. 检查 `bag_models.js` 是否正确导入

### ❌ 问题3：包显示不正常
**症状**：某个包的3D模型显示异常
**排查步骤**：
1. 检查 `bag_models.js` 中对应的创建函数
2. 查看浏览器控制台是否有Three.js错误
3. 尝试其他包是否正常（排除全局问题）

### ❌ 问题4：切换后表情出错
**症状**：切换包后表情不显示或显示异常
**排查步骤**：
1. 检查新包的 `bodyMesh` 引用是否正确设置
2. 查看 `bag_3d.js` 中的 `changeExpression()` 函数
3. 重新选择其他包测试

### ❌ 问题5：数据未保存
**症状**：重新加载后包仍为默认值
**排查步骤**：
1. 检查 `index.js` 中的 `saveGameData()` 是否调用
2. 查看浏览器存储中是否有数据：F12 > Application > Storage
3. 检查本地存储权限

## 测试报告模板

```markdown
# 包库功能测试报告

**测试日期**: YYYY-MM-DD
**测试人员**: [名字]
**测试环境**:
- 浏览器: Chrome/Firefox/Safari
- 设备: PC/Mobile
- 屏幕尺寸: 1920x1080

## 测试结果

| 测试项 | 预期结果 | 实际结果 | 状态 | 备注 |
|--------|---------|---------|------|------|
| 打开包库 | 面板从底部滑上 | ? | ? | |
| 浏览所有包 | 显示10个包 | ? | ? | |
| 切换包 | 包立即改变 | ? | ? | |
| 表情显示 | 表情正常 | ? | ? | |
| 深色模式 | 显示正常 | ? | ? | |
| 数据保存 | 重载后恢复 | ? | ? | |

## 问题记录

- 问题1: [描述]
  - 严重程度: 高/中/低
  - 复现步骤: [步骤]
  - 截图: [附图]

## 总体评分

功能完成度: __/100
代码质量: __/100
用户体验: __/100
性能表现: __/100

## 建议

- [建议1]
- [建议2]
```

## 验收标准

所有以下条件都满足时，功能可视为完成：

- ✅ 10个包模型都能正确生成
- ✅ 包库面板UI显示完整
- ✅ 包的切换流畅无错误
- ✅ 所有包都能正确显示表情
- ✅ 伤害飘字显示正常
- ✅ 深色/浅色模式都适配
- ✅ 用户选择能正确保存
- ✅ 页面重载后能恢复选择
- ✅ 没有内存泄漏
- ✅ 帧率稳定在60fps

## 调试技巧

### 查看Three.js调试信息
```javascript
// 在浏览器控制台输入
this.bag3DRenderer.scene.children  // 查看所有对象
this.bag3DRenderer.bagModelMesh    // 查看当前包模型
this.bag3DRenderer.currentBagModelId  // 查看当前包ID
```

### 强制切换包
```javascript
// 在浏览器控制台输入
page.bag3DRenderer.changeBagModel('jelly')
page.bag3DRenderer.changeBagModel('crystal')
// 等等
```

### 查看包列表
```javascript
// 在浏览器控制台输入
page.bag3DRenderer.getBagModelList()
```

## 注意事项

1. **首次加载**：3D模型生成需要时间，请等待加载完成
2. **低端设备**：毛绒包和火焰包在低端设备上可能有性能问题
3. **预览Canvas**：预览使用单独的Canvas，可能与主Canvas有同步延迟
4. **表情同步**：切换包后表情会重新应用，可能有短暂延迟

---

**预计测试时间**: 30-45分钟
**完成后请确保**: 所有10个测试都通过 ✅
