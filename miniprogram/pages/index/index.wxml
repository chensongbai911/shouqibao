<!--index.wxml-->
<view class="container {{darkMode ? 'dark-mode' : ''}} {{screenShaking ? 'screen-shake' : ''}}">
  <!-- å¤šå·´èƒºé£æ ¼æ¸å˜èƒŒæ™¯ - å…¨å±æ²‰æµ¸å¼ -->
  <view class="gradient-background">
    <view class="gradient-layer"></view>
    <!-- æµ®åŠ¨è£…é¥°åœ†ç‚¹ -->
    <view class="bg-particle p1"></view>
    <view class="bg-particle p2"></view>
    <view class="bg-particle p3"></view>
    <view class="bg-particle p4"></view>
    <view class="bg-particle p5"></view>
    <view class="bg-particle p6"></view>
    <view class="bg-particle p7"></view>
    <view class="bg-particle p8"></view>
    <view class="bg-particle p9"></view>
    <view class="bg-particle p10"></view>
  </view>

  <!-- è¿å‡»é—ªå…‰èƒŒæ™¯ -->
  <view class="combo-flash-overlay {{comboFlash ? 'active' : ''}}"></view>

  <!-- è¿å‡»åŠ¨æ€é£˜å­—æç¤ºï¼ˆæ›¿ä»£çº¢è‰²çŸ©å½¢æ¡†ï¼‰ -->
  <view class="combo-float-text {{showComboResult ? 'show' : ''}}">
    <text class="combo-text-main">{{comboResultText}}</text>
  </view>

  <!-- é¡¶éƒ¨HUD - æ‚¬æµ®åˆ†æ•°ï¼ˆæ— èƒŒæ™¯æ¡†ï¼‰ -->
  <view class="score-hud" style="padding-top: {{statusBarHeight + 10}}px;">
    <!-- å·¦ä¸Šè§’å¤œé—´æ¨¡å¼ï¼ˆå¢å¼ºå¯è§æ€§ï¼‰ -->
    <view class="top-left-btn" bindtap="toggleDarkMode">
      <view class="mode-btn-bg"></view>
      <text class="mini-icon">{{darkMode ? 'â˜€ï¸' : 'ğŸŒ™'}}</text>
    </view>

    <!-- ä¸­å¤®å¤§åˆ†æ•° -->
    <view class="score-display">
      <text class="score-number">{{totalScore}}</text>
      <text class="score-subtitle" wx:if="{{todayScore > 0}}">ä»Šæ—¥ +{{todayScore}}</text>
      <!-- è¿å‡»å€å¢æŒ‡ç¤ºå™¨ -->
      <text class="combo-boost-indicator" wx:if="{{comboDamageBoost > 1}}">Ã—{{comboDamageBoost.toFixed(1)}}</text>
    </view>

    <!-- å³ä¸Šè§’æ­¦å™¨å±•ç¤º -->
    <view class="top-right-weapon" bindtap="openWeaponPanel">
      <view class="weapon-display-bg"></view>
      <text class="weapon-display-icon">{{currentWeapon.icon}}</text>
      <text class="weapon-display-damage">{{currentWeapon.damage}}</text>
    </view>

    <!-- è¿å‡»å¾½ç« ï¼ˆæ‚¬æµ®åœ¨åˆ†æ•°æ—ï¼‰ -->
    <view wx:if="{{comboCount > 2}}" class="combo-badge-float">
      <text class="combo-x">Ã—{{comboCount}}</text>
    </view>
  </view>

  <!-- æš´æ€’æ¨¡å¼æŒ‡ç¤ºå™¨ -->
  <view wx:if="{{rageMode}}" class="rage-indicator-float">
    ğŸ”¥ æš´æ€’æ¨¡å¼ ğŸ”¥
  </view>

  <!-- ç©ºé—²å˜²è®½æ¶ˆæ¯ -->
  <view class="taunt-message-popup {{showTauntMessage ? 'show' : ''}}">
    <view class="taunt-bubble">
      <text class="taunt-text">{{tauntText}}</text>
    </view>
  </view>

  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
  <view class="main-content">

    <!-- å—æ°”åŒ…ä¸»ä½“åŒºåŸŸ - å…¨å±è§¦æ§ -->
    <view class="bag-area touch-area" bindtap="onBagTap" bindlongpress="onBagLongPress" bind:touchstart="onTouchStart" bind:touchend="onTouchEnd">
      <!-- å½“å‰æ­¦å™¨æµ®ç°æ˜¾ç¤º -->
      <view class="floating-weapon {{bagShaking ? 'weapon-swing' : ''}}" wx:if="{{currentWeapon.id !== 'hand'}}">
        <text class="floating-weapon-icon">{{currentWeapon.icon}}</text>
      </view>

      <view class="bag-container">
        <!-- Canvas WebGL å—æ°”åŒ… -->
        <canvas
          type="webgl"
          id="bag3d-canvas"
          class="bag-3d-canvas"
          canvas-id="bag3d-canvas"
          disable-scroll="{{true}}"
        ></canvas>

        <!-- ç‚¹å‡»æç¤ºæ¶Ÿæ¼ª -->
        <view class="tap-hint-ripple" wx:if="{{showTapHint}}">
          <view class="ripple-ring r1"></view>
          <view class="ripple-ring r2"></view>
          <view class="ripple-ring r3"></view>
        </view>        <!-- åŠ¨æ€è„šåº•é˜´å½± - å¢å¼ºç‰ˆ -->
        <view class="bag-ground-shadow {{bagShaking ? 'shadow-squash' : ''}}">
          <view class="shadow-core"></view>
          <view class="shadow-blur"></view>
        </view>

        <!-- æ˜è¿·æ˜Ÿæ˜Ÿç‰¹æ•ˆ -->
        <view wx:if="{{bagExpression === 'dizzy'}}" class="dizzy-stars">
          <text class="star">â­</text>
          <text class="star">â­</text>
          <text class="star">â­</text>
        </view>
      </view>

      <!-- è§¦æ§æç¤º -->
      <view class="touch-hint" wx:if="{{!totalScore}}">
        <text class="touch-hint-icon">ğŸ‘†</text>
        <text class="touch-hint-text">ç‚¹å‡»ä»»æ„ä½ç½®å‡ºæ°”</text>
      </view>
    </view>

    <!-- ç²’å­ç‰¹æ•ˆå®¹å™¨ -->
    <view class="particles-container">
      <view
        wx:for="{{particles}}"
        wx:key="id"
        class="particle"
        style="left: {{item.x}}px; top: {{item.y}}px; width: {{item.size}}rpx; height: {{item.size}}rpx; background: {{item.color}}; --tx: {{item.vx}}rpx; --ty: {{item.vy}}rpx; transform: rotate({{item.rotation}}deg);">
      </view>
    </view>

    <!-- ä¼¤å®³é£˜å­—å®¹å™¨ - æ¼«ç”»é£æ ¼ -->
    <view class="damage-texts-container">
      <view
        wx:for="{{damageTexts}}"
        wx:key="id"
        class="damage-text-comic {{item.isCrit ? 'crit' : 'normal'}}"
        style="left: {{item.x}}px; top: {{item.y}}px;">
        <!-- æš´å‡»çˆ†ç‚¸æ°”æ³¡ -->
        <view wx:if="{{item.isCrit}}" class="crit-explosion-bubble">
          <view class="explosion-spike s1"></view>
          <view class="explosion-spike s2"></view>
          <view class="explosion-spike s3"></view>
          <view class="explosion-spike s4"></view>
          <view class="explosion-spike s5"></view>
          <view class="explosion-spike s6"></view>
          <view class="explosion-spike s7"></view>
          <view class="explosion-spike s8"></view>
        </view>
        <text class="damage-value-comic">{{item.isCrit ? 'CRIT!' : ''}}</text>
        <text class="damage-number-comic">+{{item.value}}</text>
      </view>
    </view>

    <!-- åº•éƒ¨æ‚¬æµ®Dockæ  - æ¯›ç»ç’ƒæ•ˆæœ -->
    <view class="floating-dock">
      <view class="dock-item" bindtap="openBagLibrary">
        <view class="dock-icon-wrap">
          <text class="dock-icon">ğŸ’</text>
        </view>
        <text class="dock-label">åŒ…åº“</text>
      </view>
      <view class="dock-item" bindtap="openWeaponPanel">
        <view class="dock-icon-wrap">
          <text class="dock-icon">ğŸ‘Š</text>
        </view>
        <text class="dock-label">æ­¦å™¨</text>
      </view>
      <view class="dock-item" bindtap="viewAchievements">
        <view class="dock-icon-wrap">
          <text class="dock-icon">ğŸ†</text>
        </view>
        <text class="dock-label">æˆå°±</text>
      </view>
      <view class="dock-item" bindtap="openShop">
        <view class="dock-icon-wrap">
          <text class="dock-icon">ğŸ›ï¸</text>
        </view>
        <text class="dock-label">å•†åº—</text>
      </view>
      <view class="dock-item" bindtap="openSettingsMenu">
        <view class="dock-icon-wrap">
          <text class="dock-icon">âš™ï¸</text>
        </view>
        <text class="dock-label">è®¾ç½®</text>
      </view>
      <view class="dock-item" bindtap="openReset">
        <view class="dock-icon-wrap">
          <text class="dock-icon">ğŸ”„</text>
        </view>
        <text class="dock-label">é‡ç½®</text>
      </view>
    </view>

    <!-- è®¾ç½®å¼¹å‡ºèœå•ï¼ˆæ‰‡å½¢/åŠåœ†å±•å¼€ï¼‰ -->
    <view class="settings-menu-mask {{showSettingsMenu ? 'show' : ''}}" bindtap="closeSettingsMenu"></view>
    <view class="settings-menu {{showSettingsMenu ? 'show' : ''}}">
      <view class="settings-item" bindtap="toggleBGM">
        <text class="settings-icon">{{bgmPlaying ? 'ğŸ”Š' : 'ğŸ”‡'}}</text>
        <text class="settings-text">{{bgmPlaying ? 'å…³é—­éŸ³æ•ˆ' : 'å¼€å¯éŸ³æ•ˆ'}}</text>
      </view>
      <view class="settings-item" bindtap="toggleDarkMode">
        <text class="settings-icon">{{darkMode ? 'â˜€ï¸' : 'ğŸŒ™'}}</text>
        <text class="settings-text">{{darkMode ? 'æµ…è‰²æ¨¡å¼' : 'æ·±è‰²æ¨¡å¼'}}</text>
      </view>
      <view class="settings-item" bindtap="shareResult">
        <text class="settings-icon">ğŸ“¤</text>
        <text class="settings-text">åˆ†äº«æˆ˜ç»©</text>
      </view>
      <view class="settings-item" bindtap="showAbout">
        <text class="settings-icon">â„¹ï¸</text>
        <text class="settings-text">å…³äº</text>
      </view>
    </view>
  </view>

  <!-- æ­¦å™¨é€‰æ‹©é¢æ¿ï¼ˆåº•éƒ¨å¼¹å‡º - è±ªåå¡ç‰Œé£æ ¼ï¼‰ -->
  <view class="weapon-panel-mask {{showWeaponPanel ? 'show' : ''}}" bindtap="closeWeaponPanel"></view>
  <view class="weapon-panel {{showWeaponPanel ? 'show' : ''}}">
    <!-- é¢æ¿å¤´éƒ¨ -->
    <view class="panel-header">
      <view class="panel-drag-indicator"></view>
      <text class="panel-title">âš”ï¸ æ­¦å™¨åº“</text>
      <text class="panel-subtitle">æ”¶é›†æ›´å¤šæ­¦å™¨ï¼Œé‡Šæ”¾æ›´å¤§æ€’æ°”</text>
    </view>

    <!-- å¡ç‰Œè½®æ’­åŒºåŸŸ -->
    <scroll-view class="card-carousel" scroll-x="true" enhanced="true" show-scrollbar="false" scroll-with-animation="true">
      <!-- æ™®é€šæ­¦å™¨å¡ç‰Œ -->
      <view
        wx:for="{{weapons}}"
        wx:key="id"
        class="weapon-card-wrapper"
        bindtap="switchWeapon"
        data-id="{{item.id}}"
        data-special="false">
        <view class="weapon-card rarity-{{item.rarity}} {{currentWeapon.id === item.id ? 'selected' : ''}} {{item.unlockScore > totalScore ? 'locked' : ''}}">
          <!-- å¡ç‰Œå…‰æ•ˆè¾¹æ¡† -->
          <view class="card-glow" style="--card-color: {{item.color}};"></view>

          <!-- ç¨€æœ‰åº¦æ ‡ç­¾ -->
          <view class="rarity-badge rarity-{{item.rarity}}">
            <text wx:if="{{item.rarity === 'common'}}">æ™®é€š</text>
            <text wx:if="{{item.rarity === 'uncommon'}}">ä¼˜ç§€</text>
            <text wx:if="{{item.rarity === 'rare'}}">ç¨€æœ‰</text>
            <text wx:if="{{item.rarity === 'epic'}}">å²è¯—</text>
          </view>

          <!-- æ­¦å™¨å›¾æ ‡åŒº -->
          <view class="card-icon-area">
            <view class="weapon-icon-3d" style="--card-color: {{item.color}};">
              <text class="weapon-main-icon">{{item.icon}}</text>
            </view>
          </view>

          <!-- æ­¦å™¨åç§° -->
          <text class="card-weapon-name">{{item.name}}</text>

          <!-- å±æ€§æ˜Ÿçº§ -->
          <view class="card-stats">
            <view class="stat-row">
              <text class="stat-label">æ”»å‡»</text>
              <view class="stat-stars">
                <text wx:for="{{5}}" wx:key="*this" wx:for-item="star" class="star {{star < item.attackStars ? 'filled' : ''}}">â˜…</text>
              </view>
            </view>
            <view class="stat-row">
              <text class="stat-label">æ”»é€Ÿ</text>
              <view class="stat-stars">
                <text wx:for="{{5}}" wx:key="*this" wx:for-item="star" class="star {{star < item.speedStars ? 'filled' : ''}}">â˜…</text>
              </view>
            </view>
            <view class="stat-row">
              <text class="stat-label">æš´å‡»</text>
              <view class="stat-stars">
                <text wx:for="{{5}}" wx:key="*this" wx:for-item="star" class="star {{star < item.critStars ? 'filled' : ''}}">â˜…</text>
              </view>
            </view>
          </view>

          <!-- ä¼¤å®³æ•°å€¼ -->
          <view class="card-damage">
            <text class="damage-value">{{item.damage}}</text>
            <text class="damage-label">ä¼¤å®³</text>
          </view>

          <!-- æè¿°æ–‡å­— -->
          <text class="card-description">{{item.description}}</text>

          <!-- é€‰ä¸­æ ‡è®° -->
          <view wx:if="{{currentWeapon.id === item.id}}" class="equipped-badge">
            <text>âœ“ è£…å¤‡ä¸­</text>
          </view>

          <!-- é”å®šé®ç½© -->
          <view wx:if="{{item.unlockScore > totalScore}}" class="card-lock-overlay">
            <view class="lock-content">
              <text class="lock-icon-big">ğŸ”’</text>
              <text class="lock-requirement">éœ€è¦ {{item.unlockScore}} åˆ†</text>
            </view>
          </view>
        </view>
      </view>

      <!-- åˆ†éš”çº¿ -->
      <view class="card-divider">
        <view class="divider-line"></view>
        <text class="divider-text">ä¼ è¯´æ­¦å™¨</text>
        <view class="divider-line"></view>
      </view>

      <!-- ç‰¹æ®Šæ­¦å™¨å¡ç‰Œï¼ˆä¼ è¯´çº§ï¼‰ -->
      <view
        wx:for="{{specialWeapons}}"
        wx:key="id"
        class="weapon-card-wrapper"
        bindtap="switchWeapon"
        data-id="{{item.id}}"
        data-special="true">
        <view class="weapon-card rarity-{{item.rarity}} {{currentWeapon.id === item.id ? 'selected' : ''}} {{!item.unlocked ? 'locked' : ''}}">
          <!-- å¡ç‰Œå…‰æ•ˆè¾¹æ¡† -->
          <view class="card-glow legendary" style="--card-color: {{item.color}};"></view>

          <!-- ç¨€æœ‰åº¦æ ‡ç­¾ -->
          <view class="rarity-badge rarity-{{item.rarity}}">
            <text wx:if="{{item.rarity === 'legendary'}}">ä¼ è¯´</text>
            <text wx:if="{{item.rarity === 'mythic'}}">ç¥è¯</text>
          </view>

          <!-- æ­¦å™¨å›¾æ ‡åŒº -->
          <view class="card-icon-area">
            <view class="weapon-icon-3d legendary" style="--card-color: {{item.color}};">
              <text class="weapon-main-icon">{{item.icon}}</text>
            </view>
          </view>

          <!-- æ­¦å™¨åç§° -->
          <text class="card-weapon-name">{{item.name}}</text>

          <!-- å±æ€§æ˜Ÿçº§ -->
          <view class="card-stats">
            <view class="stat-row">
              <text class="stat-label">æ”»å‡»</text>
              <view class="stat-stars">
                <text wx:for="{{5}}" wx:key="*this" wx:for-item="star" class="star {{star < item.attackStars ? 'filled' : ''}}">â˜…</text>
              </view>
            </view>
            <view class="stat-row">
              <text class="stat-label">æ”»é€Ÿ</text>
              <view class="stat-stars">
                <text wx:for="{{5}}" wx:key="*this" wx:for-item="star" class="star {{star < item.speedStars ? 'filled' : ''}}">â˜…</text>
              </view>
            </view>
            <view class="stat-row">
              <text class="stat-label">æš´å‡»</text>
              <view class="stat-stars">
                <text wx:for="{{5}}" wx:key="*this" wx:for-item="star" class="star {{star < item.critStars ? 'filled' : ''}}">â˜…</text>
              </view>
            </view>
          </view>

          <!-- ä¼¤å®³æ•°å€¼ -->
          <view class="card-damage legendary">
            <text class="damage-value">{{item.damage}}</text>
            <text class="damage-label">ä¼¤å®³</text>
          </view>

          <!-- æè¿°æ–‡å­— -->
          <text class="card-description">{{item.description}}</text>

          <!-- é€‰ä¸­æ ‡è®° -->
          <view wx:if="{{currentWeapon.id === item.id}}" class="equipped-badge legendary">
            <text>âœ“ è£…å¤‡ä¸­</text>
          </view>

          <!-- é”å®šé®ç½© -->
          <view wx:if="{{!item.unlocked}}" class="card-lock-overlay legendary">
            <view class="lock-content">
              <text class="lock-icon-big">ğŸ”’</text>
              <text class="lock-requirement">{{item.unlockCondition}}</text>
            </view>
          </view>
        </view>
      </view>
    </scroll-view>

    <!-- å…³é—­æŒ‰é’® -->
    <view class="panel-footer">
      <view class="close-panel-btn" bindtap="closeWeaponPanel">
        <text>å…³é—­æ­¦å™¨åº“</text>
      </view>
    </view>
  </view>

  <!-- æˆå°±è£èª‰å¢™é¢æ¿ -->
  <view class="achievement-panel-mask {{showAchievementPanel ? 'show' : ''}}" bindtap="closeAchievementPanel"></view>
  <view class="achievement-panel {{showAchievementPanel ? 'show' : ''}}">
    <!-- é¢æ¿å¤´éƒ¨ -->
    <view class="achievement-header">
      <view class="panel-drag-indicator"></view>
      <text class="achievement-title">ğŸ† è£èª‰å¢™</text>
      <text class="achievement-subtitle">æ”¶é›†æ‰€æœ‰æˆå°±ï¼Œæˆä¸ºå‡ºæ°”å¤§å¸ˆ</text>
    </view>

    <!-- æˆå°±ç½‘æ ¼ -->
    <scroll-view class="trophy-shelf" scroll-y="true" enhanced="true" show-scrollbar="false">
      <view class="trophy-grid">
        <view
          wx:for="{{achievements}}"
          wx:key="id"
          class="trophy-item {{item.unlocked ? 'unlocked' : 'locked'}} rarity-{{item.rarity}}">
          <!-- å¥–æ¯åº•åº§ -->
          <view class="trophy-pedestal">
            <!-- å¥–æ¯/å‰ªå½± -->
            <view class="trophy-display">
              <text class="trophy-icon {{item.unlocked ? '' : 'silhouette'}}">{{item.icon}}</text>
              <!-- å…‰èŠ’æ•ˆæœ -->
              <view wx:if="{{item.unlocked}}" class="trophy-glow"></view>
            </view>
            <!-- é”å®šå›¾æ ‡ -->
            <view wx:if="{{!item.unlocked}}" class="trophy-lock">
              <text class="lock-icon">ğŸ”’</text>
            </view>
          </view>
          <!-- æˆå°±ä¿¡æ¯ -->
          <view class="trophy-info">
            <text class="trophy-name {{item.unlocked ? '' : 'hidden-name'}}">{{item.unlocked ? item.name : '???'}}</text>
            <text class="trophy-condition">{{item.condition}}</text>
          </view>
        </view>
      </view>
    </scroll-view>

    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <view class="achievement-stats">
      <view class="stat-item">
        <text class="stat-num">{{unlockedAchievementCount}}</text>
        <text class="stat-label">å·²è§£é”</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <text class="stat-num">{{achievements.length}}</text>
        <text class="stat-label">æ€»æˆå°±</text>
      </view>
    </view>

    <!-- å…³é—­æŒ‰é’® -->
    <view class="achievement-footer">
      <view class="close-achievement-btn" bindtap="closeAchievementPanel">
        <text>å…³é—­è£èª‰å¢™</text>
      </view>
    </view>
  </view>

  <!-- æˆå°±è§£é”å…¨å±åŠ¨ç”» -->
  <view class="achievement-unlock-overlay {{showAchievementUnlock ? 'show' : ''}}">
    <view class="unlock-content">
      <view class="unlock-rays">
        <view class="ray r1"></view>
        <view class="ray r2"></view>
        <view class="ray r3"></view>
        <view class="ray r4"></view>
        <view class="ray r5"></view>
        <view class="ray r6"></view>
      </view>
      <view class="unlock-trophy-wrap">
        <text class="unlock-trophy-icon">{{newAchievement.icon}}</text>
      </view>
      <text class="unlock-label">æˆå°±è§£é”</text>
      <text class="unlock-name">{{newAchievement.name}}</text>
      <view class="unlock-sparkles">
        <text class="sparkle s1">âœ¨</text>
        <text class="sparkle s2">âœ¨</text>
        <text class="sparkle s3">âœ¨</text>
        <text class="sparkle s4">âœ¨</text>
      </view>
    </view>
  </view>

  <!-- åˆ†äº«å¡ç‰‡é¢æ¿ -->
  <view class="share-card-mask {{showShareCard ? 'show' : ''}}" bindtap="closeShareCard"></view>
  <view class="share-card-panel {{showShareCard ? 'show' : ''}}">
    <!-- å¡ç‰‡é¢„è§ˆåŒº -->
    <view class="share-card-preview" id="shareCardCanvas">
      <!-- å¡ç‰‡èƒŒæ™¯ -->
      <view class="card-bg-gradient"></view>

      <!-- é¡¶éƒ¨è£…é¥° -->
      <view class="card-top-decor">
        <text class="card-app-name">ğŸ˜¤ å—æ°”åŒ…</text>
        <text class="card-slogan">å‡ºæ°”ç¥å™¨Â·æ²»æ„ˆå¿ƒæƒ…</text>
      </view>

      <!-- ä¸»è§’åŒºåŸŸ -->
      <view class="card-hero-section">
        <view class="card-bag-wrap">
          <text class="card-expression">{{shareCardData.moodEmoji}}</text>
        </view>
        <view class="card-title-wrap">
          <text class="card-user-title">{{shareCardData.funnyTag}}</text>
        </view>
      </view>

      <!-- æ•°æ®åŒºåŸŸ -->
      <view class="card-data-section">
        <view class="data-item main">
          <text class="data-value">{{shareCardData.totalScore}}</text>
          <text class="data-label">æ€»ä¼¤å®³</text>
        </view>
        <view class="data-divider"></view>
        <view class="data-item">
          <text class="data-value">{{shareCardData.todayScore}}</text>
          <text class="data-label">ä»Šæ—¥è¾“å‡º</text>
        </view>
        <view class="data-divider"></view>
        <view class="data-item">
          <text class="data-value">{{shareCardData.weaponName}}</text>
          <text class="data-label">æƒ¯ç”¨æ­¦å™¨</text>
        </view>
      </view>

      <!-- è¶£å‘³æ ‡ç­¾ -->
      <view class="card-tags">
        <text class="fun-tag" wx:if="{{shareCardData.totalScore > 10000}}">#æš´åŠ›ç¾å­¦</text>
        <text class="fun-tag" wx:if="{{shareCardData.totalScore > 5000}}">#å‹åŠ›ç²‰ç¢æœº</text>
        <text class="fun-tag">#æƒ…ç»ªç®¡ç†å¤§å¸ˆ</text>
        <text class="fun-tag">#å‡ºæ°”è¾¾äºº</text>
      </view>

      <!-- åº•éƒ¨ä¿¡æ¯åŒº -->
      <view class="card-footer-section">
        <text class="card-date">{{shareCardData.date}}</text>
        <view class="qr-placeholder">
          <text class="qr-icon">ğŸ“±</text>
          <text class="qr-hint">æ‰«ç ä¸€èµ·å‡ºæ°”</text>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="share-actions">
      <view class="share-btn save" bindtap="saveShareCard">
        <text class="share-btn-icon">ğŸ’¾</text>
        <text class="share-btn-text">ä¿å­˜å›¾ç‰‡</text>
      </view>
      <view class="share-btn send" bindtap="shareToFriend">
        <text class="share-btn-icon">ğŸ“¤</text>
        <text class="share-btn-text">åˆ†äº«å¥½å‹</text>
      </view>
    </view>

    <!-- å…³é—­æŒ‰é’® -->
    <view class="share-close" bindtap="closeShareCard">
      <text>âœ•</text>
    </view>
  </view>

  <!-- åŒ…åº“é¢æ¿ -->
  <view class="bag-library-mask {{showBagLibrary ? 'show' : ''}}" bindtap="closeBagLibrary"></view>
  <view class="bag-library-panel {{showBagLibrary ? 'show' : ''}}">
    <!-- é¢æ¿å¤´éƒ¨ -->
    <view class="bag-lib-header">
      <view class="bag-lib-drag-indicator"></view>
      <text class="bag-lib-title">ğŸ’ åŒ…åº“</text>
      <text class="bag-lib-subtitle">é€‰æ‹©ä½ å–œæ¬¢çš„åŒ…æ ·å¼</text>
      <view class="bag-lib-close" bindtap="closeBagLibrary">âœ•</view>
    </view>

    <!-- åŒ…æ¨¡å‹ç½‘æ ¼ -->
    <scroll-view class="bag-lib-scroll" scroll-y="true" enhanced="true" show-scrollbar="false">
      <view class="bag-lib-grid">
        <view
          wx:for="{{bagModelList}}"
          wx:key="id"
          class="bag-lib-item {{currentBagModelId === item.id ? 'selected' : ''}}"
          bindtap="selectBagModel"
          data-id="{{item.id}}">
          <!-- åŒ…çš„3Dé¢„è§ˆï¼ˆç®€åŒ–ä¸ºå›¾æ ‡ï¼‰ -->
          <view class="bag-preview-container">
            <view class="bag-preview-icon">ğŸ’</view>
            <!-- é€‰ä¸­å‹¾é€‰æ ‡è®° -->
            <view wx:if="{{currentBagModelId === item.id}}" class="bag-selected-badge">
              <text class="badge-icon">âœ“</text>
            </view>
          </view>

          <!-- åŒ…çš„ä¿¡æ¯ -->
          <view class="bag-lib-info">
            <text class="bag-lib-name">{{item.name}}</text>
            <text class="bag-lib-rarity rarity-{{item.rarity}}">{{item.rarity}}</text>
            <text class="bag-lib-desc">{{item.description}}</text>
          </view>

          <!-- ç¨€æœ‰åº¦æ ‡ç­¾ -->
          <view class="bag-rarity-label rarity-{{item.rarity}}">
            <text wx:if="{{item.rarity === 'common'}}">æ™®é€š</text>
            <text wx:if="{{item.rarity === 'uncommon'}}">ä¼˜ç§€</text>
            <text wx:if="{{item.rarity === 'rare'}}">ç¨€æœ‰</text>
            <text wx:if="{{item.rarity === 'epic'}}">å²è¯—</text>
            <text wx:if="{{item.rarity === 'legendary'}}">ä¼ è¯´</text>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>
</view>
