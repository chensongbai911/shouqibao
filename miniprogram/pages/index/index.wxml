<!--index.wxml-->
<view class="container {{darkMode ? 'dark-mode' : ''}}">
  <!-- é¡¶éƒ¨åˆ†æ•°æ˜¾ç¤º -->
  <view class="score-display">
    <view class="score-label">æ€»ä¼¤å®³</view>
    <view class="score-value">{{totalScore}}</view>
    <view wx:if="{{comboCount > 2}}" class="combo-counter">
      è¿å‡» x{{comboCount}}
    </view>
  </view>

  <!-- æš´æ€’æ¨¡å¼æŒ‡ç¤ºå™¨ -->
  <view wx:if="{{rageMode}}" class="rage-indicator">
    ğŸ”¥ æš´æ€’æ¨¡å¼ ğŸ”¥
  </view>

  <!-- æš—é»‘æ¨¡å¼åˆ‡æ¢æŒ‰é’® -->
  <view class="settings-button" bindtap="toggleDarkMode">
    <text>{{darkMode ? 'â˜€ï¸' : 'ğŸŒ™'}}</text>
  </view>

  <!-- BGMæ§åˆ¶æŒ‰é’® -->
  <view class="bgm-control" bindtap="toggleBGM">
    <text class="bgm-icon">{{bgmPlaying ? 'ğŸ”Š' : 'ğŸ”‡'}}</text>
  </view>

  <!-- å—æ°”åŒ…ä¸»ä½“ -->
  <view class="bag-container">
    <image
      class="bag-image {{bagShaking ? 'shaking' : ''}} expression-{{bagExpression}}"
      src="{{useCustomFace ? customFaceUrl : '/images/bag_normal.png'}}"
      mode="{{useCustomFace ? 'aspectFill' : 'aspectFit'}}"
      bindtap="onBagTap"
      bind:touchstart="onTouchStart"
    />

    <!-- æ˜è¿·æ˜Ÿæ˜Ÿç‰¹æ•ˆ -->
    <view wx:if="{{bagExpression === 'dizzy'}}" class="dizzy-stars">
      <text class="star">â­</text>
      <text class="star">â­</text>
      <text class="star">â­</text>
    </view>
  </view>

  <!-- ç²’å­ç‰¹æ•ˆå®¹å™¨ï¼ˆç§»åˆ°å¤–é¢ï¼Œè¦†ç›–æ•´ä¸ªå±å¹•ï¼‰ -->
  <view class="particles-container">
    <view
      wx:for="{{particles}}"
      wx:key="id"
      class="particle"
      style="left: {{item.x}}px; top: {{item.y}}px; width: {{item.size}}rpx; height: {{item.size}}rpx; background: {{item.color}}; --tx: {{item.vx}}rpx; --ty: {{item.vy}}rpx; transform: rotate({{item.rotation}}deg);">
    </view>
  </view>

  <!-- ä¼¤å®³é£˜å­—å®¹å™¨ï¼ˆç§»åˆ°å¤–é¢ï¼Œè¦†ç›–æ•´ä¸ªå±å¹•ï¼‰ -->
  <view class="damage-texts-container">
    <view
      wx:for="{{damageTexts}}"
      wx:key="id"
      class="damage-text {{item.isCrit ? 'crit' : 'normal'}}"
      style="left: {{item.x}}px; top: {{item.y}}px;">
      {{item.isCrit ? 'CRIT! ' : ''}}{{item.value}}
    </view>
  </view>

  <!-- æ­¦å™¨ä¿¡æ¯æ˜¾ç¤º -->
  <view class="weapon-info">
    <view class="weapon-name">
      {{currentWeapon.icon}} {{currentWeapon.name}}
    </view>
    <view class="weapon-damage">
      ä¼¤å®³: {{currentWeapon.damage}}
    </view>
  </view>

  <!-- æ­¦å™¨é€‰æ‹©åŒºåŸŸ -->
  <view class="weapons-section">
    <view class="section-title">é€‰æ‹©æ­¦å™¨</view>
    <view class="weapons-grid">
      <view
        wx:for="{{weapons}}"
        wx:key="id"
        class="weapon-card {{currentWeapon.id === item.id ? 'active' : ''}} {{item.unlockScore > totalScore ? 'locked' : ''}}"
        bindtap="switchWeapon"
        data-id="{{item.id}}">
        <view class="weapon-icon">{{item.icon}}</view>
        <view class="weapon-name-text">{{item.name}}</view>
        <view class="weapon-damage-text">ä¼¤å®³: {{item.damage}}</view>
        <view wx:if="{{item.unlockScore > totalScore}}" class="weapon-unlock-hint">
          éœ€è¦ {{item.unlockScore}} åˆ†
        </view>
        <text wx:if="{{item.unlockScore > totalScore}}" class="lock-icon">ğŸ”’</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
  <view class="controls">
    <button class="control-btn" bindtap="chooseCustomFace">ğŸ“· æ¢è„¸</button>
    <button class="control-btn" bindtap="resetFace">â†©ï¸ æ¢å¤</button>
    <button class="control-btn primary" bindtap="resetScore">ğŸ”„ é‡ç½®</button>
  </view>
</view>
