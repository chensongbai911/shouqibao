# “受气包”解压小程序 - 产品需求与技术方案文档

**版本号：** V1.0.0
**更新日期：** 2025-12-05
**技术栈方向：** Vue / UniApp + 微信云开发

---

## 1. 项目概述 (Project Overview)

### 1.1 产品背景
现代生活节奏快，年轻人（职场人、学生）普遍面临较大的精神压力。市场上缺乏轻量级、即开即用、纯粹用于宣泄负面情绪的趣味工具。

### 1.2 核心价值
*   **情绪宣泄**：通过高频点击、视觉反馈、听觉刺激，提供瞬间的爽感。
*   **趣味互动**：丑萌的画风和搞怪的反馈，将负面情绪转化为娱乐体验。

---

## 2. 技术选型 (Technology Stack)

基于开发效率和跨平台扩展性考虑，采用以下技术栈：

| 模块 | 选型 | 理由 |
| :--- | :--- | :--- |
| **前端框架** | **UniApp** | 语法基于 **Vue.js**，上手快；一套代码可发布到微信小程序、抖音小程序等。 |
| **编程语言** | **JavaScript** | 快速开发 MVP（最小可行性产品）。 |
| **UI 样式** | **CSS3 / SCSS** | 使用 CSS Keyframes 实现核心的抖动、缩放动画，性能足够且开发简单。 |
| **后端/数据库** | **微信云开发 (CloudBase)** | **Serverless 模式**。免服务器运维，免费额度够用，直接在前端调用 DB，极适合个人开发者。 |
| **多媒体** | **uni.createInnerAudioContext** | 处理高频点击时的音效并发播放。 |
| **触感反馈** | **uni.vibrateShort** | 调用手机线性马达，提供物理打击感。 |

---

## 3. 需求分析与功能列表 (Requirements Analysis)

### 3.1 用户画像
*   **加班的社畜**：想揍老板但不敢动手。
*   **考试的学生**：被题目折磨需要发泄。
*   **无聊的网友**：单纯想找点东西狂点打发时间。

### 3.2 功能优先级 (Feature List)

| 优先级 | 模块 | 功能点 | 描述 |
| :--- | :--- | :--- | :--- |
| **P0** | **打击核心** | **点击反馈** | 点击屏幕受气包，触发受击动画（变形/抖动）+ 播放音效 + 手机震动。 |
| **P0** | **视觉反馈** | **表情变化** | 根据连击次数（Combo），受气包表情从“贱笑”变为“哭泣/鼻青脸肿”。 |
| **P0** | **数值系统** | **伤害飙字** | 每次点击弹出飘字动画（-1, 暴击!），顶部显示累计暴击总分。 |
| **P1** | **道具系统** | **武器切换** | 提供[拳头]、[拖鞋]、[平底锅]切换，对应不同的击打音效和贴图。 |
| **P1** | **自定义** | **DIY换脸** | 用户可上传手机相册图片，裁切成圆形贴在受气包脸上。 |
| **P2** | **社交** | **排行榜** | 基于云开发的“今日解压榜” (按点击次数排名)。 |
| **P2** | **功能** | **吐槽弹幕** | 输入文字发送，文字化作实体砸向受气包。 |

---

## 4. 产品原型设计 (Prototype Design)

### 4.1 整体 UI 风格
*   **色调**：高饱和度暖色（橙红、明黄），激发情绪。
*   **风格**：手绘、丑萌、夸张、粗线条。

### 4.2 页面布局 (Page Layout)

#### 页面：首页 (Home / Arena)
这是应用的主战场，单页式设计。

*   **顶部区域 (Top Bar)**
    *   `[左]` 设置按钮（齿轮图标）：控制音效/震动开关。
    *   `[中]` 血条/怒气槽：随点击次数增加而减少或变色。
    *   `[右]` 累计分数：大号数字显示。
*   **中央舞台 (Center Stage)**
    *   **受气包 (The Target)**：位于屏幕正中央，占屏比 50%。
    *   **特效层**：位于受气包上层，用于渲染“汗水”、“星星”、“伤害数字”。
*   **底部操作栏 (Bottom Dock)**
    *   `[按钮1]` **武器库**：点击弹出半屏弹窗选择武器。
    *   `[按钮2]` **换脸**：点击调用相册或涂鸦板。
    *   `[按钮3]` **排行榜**：查看世界排名。

### 4.3 交互细节 (Interaction)
1.  **待机状态 (Idle)**：受气包轻微上下浮动（CSS `translateY`），表情挑衅。
2.  **点击状态 (Tap)**：
    *   受气包瞬间缩小（`scale(0.9)`）并左右剧烈晃动。
    *   手机短震动（15ms）。
    *   随机播放音效池中的一个声音。
3.  **恢复状态 (Recover)**：停止点击 2 秒后，受气包慢慢恢复原状，表情变回挑衅，并弹出一个气泡：“就这点力气？”

---

## 5. 技术架构与代码结构 (Technical Architecture)

### 5.1 目录结构 (UniApp)
```text
project-root
├── cloudfunctions/       # 微信云函数 (用于获取 OpenID, 排行榜读写)
├── unpackage/            # 编译输出目录
├── static/               # 静态资源
│   ├── images/           # 存放受气包表情 (normal.png, hit.png, dizzy.png)
│   └── audio/            # 存放音效 (punch.mp3, slap.mp3, scream.mp3)
├── components/           # Vue 组件
│   ├── BagSprite.vue     # [核心] 受气包组件 (包含动画逻辑)
│   ├── HitText.vue       # [特效] 伤害飘字组件
│   └── WeaponPanel.vue   # [UI] 武器选择面板
├── pages/
│   └── index/
│       └── index.vue     # 主页面 (负责组装组件、监听全局点击)
├── store/                # 状态管理 (Pinia 或 Vuex)
│   └── index.js          # 存储: currentScore, currentWeapon, isMuted
├── App.vue               # 全局入口
├── manifest.json         # 配置文件 (小程序 AppID 等)
└── uni.scss              # 全局样式
```

### 5.2 核心逻辑实现方案

#### A. 动画实现 (CSS vs JS)
推荐使用 **CSS Class 切换** 方案，性能最好。
```css
/* 定义抖动动画 */
@keyframes shake {
  0% { transform: translate(0, 0) rotate(0deg); }
  25% { transform: translate(-5px, 5px) rotate(-5deg); }
  75% { transform: translate(5px, -5px) rotate(5deg); }
  100% { transform: translate(0, 0) rotate(0deg); }
}
.is-hit {
  animation: shake 0.1s ease-in-out;
  transform: scale(0.95); /* 配合缩放更有打击感 */
}
```

#### B. 音效并发 (Audio Pool)
解决连续点击时音效被截断的问题。
*   **问题**：单实例 `audio.play()` 如果在前一次未播完时再次调用，通常会停止前一次重播，导致声音断断续续。
*   **方案**：初始化创建 5-10 个 `InnerAudioContext` 放入数组。每次点击，从数组中取下一个空闲或最久未使用的实例播放。

#### C. 状态机 (Vue Ref)
在 `BagSprite.vue` 中维护状态：
```javascript
// 伪代码
const bagState = ref('idle'); // idle, hit, dizzy

const hit = () => {
  bagState.value = 'hit';
  // 播放音效...
  // 震动...

  // 防抖重置
  clearTimeout(timer);
  timer = setTimeout(() => {
    bagState.value = 'idle';
  }, 200);
}
```

---

## 6. 开发路线图 (Roadmap)

1.  **Day 1: 骨架搭建**
    *   创建 UniApp 项目。
    *   完成首页静态布局。
    *   实现核心点击 -> CSS 动画反馈。
2.  **Day 2: 多媒体与逻辑**
    *   集成 Audio 音效池。
    *   集成 `uni.vibrateShort`。
    *   实现数值飘字逻辑。
3.  **Day 3: 完善功能**
    *   添加 3 种武器切换逻辑。
    *   添加简单的换脸功能（使用 `<image mode="aspectFill">`）。
4.  **Day 4: 云开发接入**
    *   开通云环境。
    *   写一个云函数记录最高分。
5.  **Day 5: 测试与发布**
    *   真机调试（特别是 iOS 下的音频播放策略）。
    *   提交微信审核。
