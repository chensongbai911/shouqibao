# 📚 STEP 3: 创建数据库集合 (完整指南)

**目标:** 在云开发控制台创建3个数据库集合
**预计时间:** 10-15分钟
**难度:** ⭐ 简单
**状态:** 待执行

---

## 📋 需要创建的3个集合

### 集合 1️⃣ : `user_data` (用户数据集合)

**用途:** 存储每个用户的游戏数据

**创建步骤:**

```
1. 打开微信云开发控制台
   网址: https://console.cloud.tencent.com/tcb

2. 选择你的环境: cloud1-0g29mlsv3d4ca637

3. 点击左侧菜单 → 数据库

4. 点击 "新增集合" 按钮

5. 输入集合名称: user_data

6. 点击 "确定"
```

**设置字段:**

| 字段名 | 类型 | 说明 |
|--------|------|------|
| userId | String | 用户唯一ID (OpenID) |
| score | Number | 用户当前最高分数 |
| achievements | Array | 用户已解锁成就 |
| weapons | Array | 用户已解锁武器 |
| lastUpdateTime | Date | 最后更新时间 |

**权限设置:**
```
创建:  仅创建者 (用户能自己创建)
读取:  所有用户 (其他用户能查看)
更新:  仅创建者 (用户能更新自己数据)
删除:  仅创建者 (用户能删除自己数据)
```

---

### 集合 2️⃣ : `achievements` (成就集合)

**用途:** 存储用户的成就解锁情况

**创建步骤:**

```
1. 在数据库菜单中再次点击 "新增集合"

2. 输入集合名称: achievements

3. 点击 "确定"
```

**设置字段:**

| 字段名 | 类型 | 说明 |
|--------|------|------|
| userId | String | 用户唯一ID |
| achievementId | String | 成就ID (puncher/destroyer等) |
| unlocked | Boolean | 是否已解锁 |
| unlockedTime | Date | 解锁时间 |

**权限设置:**
```
创建:  仅创建者
读取:  所有用户
更新:  仅创建者
删除:  仅创建者
```

---

### 集合 3️⃣ : `leaderboard` (排行榜集合)

**用途:** 存储游戏排行榜数据

**创建步骤:**

```
1. 在数据库菜单中再次点击 "新增集合"

2. 输入集合名称: leaderboard

3. 点击 "确定"
```

**设置字段:**

| 字段名 | 类型 | 说明 |
|--------|------|------|
| userId | String | 用户唯一ID |
| score | Number | 用户分数 |
| rankDate | Date | 排名日期 |
| userName | String | 用户名 (可选) |

**权限设置:**
```
创建:  仅创建者
读取:  所有用户
更新:  仅创建者
删除:  仅创建者
```

---

## 🎯 完整流程 (图文说明)

### 步骤 1: 打开云开发控制台

```
访问网址: https://console.cloud.tencent.com/tcb
使用微信账号登录
选择你的环境: cloud1-0g29mlsv3d4ca637
```

### 步骤 2: 进入数据库菜单

```
左侧菜单:
  ├─ 环境
  ├─ 数据库 ← 点击这里
  ├─ 云函数
  ├─ 云存储
  └─ ...
```

### 步骤 3: 创建第一个集合 (user_data)

```
按钮位置:
  数据库 > [新增集合] 按钮

输入框:
  集合名: user_data

点击确定
```

**检查点:**
```
✓ 集合名称正确: user_data
✓ 集合已创建
✓ 显示在集合列表中
```

### 步骤 4: 创建第二个集合 (achievements)

```
重复步骤 3，输入集合名: achievements
```

**检查点:**
```
✓ 集合名称正确: achievements
✓ 集合已创建
✓ 现在有2个集合
```

### 步骤 5: 创建第三个集合 (leaderboard)

```
重复步骤 3，输入集合名: leaderboard
```

**检查点:**
```
✓ 集合名称正确: leaderboard
✓ 集合已创建
✓ 现在有3个集合
```

---

## ⚙️ 权限设置详解

### 什么是权限?

```
创建 (Create):  谁能在这个集合中创建新记录
读取 (Read):    谁能查看集合中的数据
更新 (Update):  谁能修改已有的记录
删除 (Delete):  谁能删除集合中的记录
```

### 权限选项含义

```
仅创建者:  只有创建这条记录的用户能操作
所有用户:  任何用户都能操作 (不安全)
自定义:    可以写自定义权限表达式
```

### 推荐权限设置

```
user_data 集合:
  ├─ 创建: 仅创建者 (用户创建自己的数据)
  ├─ 读取: 所有用户 (可以查看别人分数)
  ├─ 更新: 仅创建者 (只能改自己数据)
  └─ 删除: 仅创建者 (只能删自己数据)

achievements 集合:
  ├─ 创建: 仅创建者
  ├─ 读取: 所有用户
  ├─ 更新: 仅创建者
  └─ 删除: 仅创建者

leaderboard 集合:
  ├─ 创建: 仅创建者
  ├─ 读取: 所有用户
  ├─ 更新: 仅创建者
  └─ 删除: 仅创建者
```

---

## 📱 如何设置权限

### 在云开发控制台中

```
1. 点击集合名称进入集合详情

2. 点击右上方 "权限" 按钮

3. 设置各个操作的权限:

   创建权限:    选择 "仅创建者"
   读取权限:    选择 "所有用户"
   更新权限:    选择 "仅创建者"
   删除权限:    选择 "仅创建者"

4. 点击 "保存" 或 "确定"
```

---

## ✅ 完成检查清单

完成创建后，检查以下项目：

```
集合创建检查:
  ☐ user_data 集合已创建
  ☐ achievements 集合已创建
  ☐ leaderboard 集合已创建
  ☐ 三个集合都显示在列表中

权限设置检查:
  ☐ user_data 权限已设置
  ☐ achievements 权限已设置
  ☐ leaderboard 权限已设置
  ☐ 所有权限设置正确

验证检查:
  ☐ 能打开每个集合的详情页面
  ☐ 集合中还没有数据 (新建)
  ☐ 集合名称拼写正确
```

---

## 🆘 常见问题

### 问题 1: 看不到"新增集合"按钮

**可能原因:**
- 云开发权限未开启
- 环境还在初始化

**解决方案:**
```
1. 确认已登录微信账号
2. 确认选择了正确的环境
3. 刷新页面重试
4. 等待2-3分钟让环境初始化完成
```

### 问题 2: 创建集合时提示错误

**可能原因:**
- 集合名称包含特殊字符
- 集合名称过长
- 网络连接问题

**解决方案:**
```
1. 确保集合名称只包含字母和下划线
2. 集合名称不要超过30个字符
3. 检查网络连接
4. 重新尝试创建
```

### 问题 3: 集合已创建但找不到

**可能原因:**
- 需要刷新页面
- 集合在列表中但向下滚动看不到

**解决方案:**
```
1. 按 F5 刷新页面
2. 向下滚动查看集合列表
3. 搜索集合名称
4. 确认环境ID是否正确
```

### 问题 4: 权限设置出错

**可能原因:**
- 权限未保存
- 选择了错误的权限级别

**解决方案:**
```
1. 重新点击权限按钮
2. 确保都选择 "仅创建者" 或 "所有用户"
3. 点击保存/确定按钮
4. 刷新页面查看是否生效
```

---

## 💡 提示

### 集合命名规则

```
✅ 正确的名称:
  user_data
  achievements
  leaderboard
  user_info
  game_scores

❌ 错误的名称:
  user-data     (包含连字符)
  User Data     (包含空格)
  用户数据      (中文字符)
  user#data     (特殊字符)
```

### 安全提示

```
⚠️ 注意:
  • 不要给所有操作都设置 "所有用户" 权限
  • "创建" 权限应该是 "仅创建者"
  • "更新/删除" 权限应该是 "仅创建者"
  • "读取" 权限可以是 "所有用户" (让用户看排行榜)
```

---

## 🎯 下一步

完成 STEP 3 后：

1. ✅ 检查所有3个集合都已创建
2. ✅ 确认权限设置正确
3. ✅ 刷新页面看到集合列表

**然后继续 STEP 4：打开游戏测试**

---

## 📊 进度跟踪

```
✅ STEP 1: 环境ID配置        [完成]
✅ STEP 2: 部署云函数 login  [完成]
⏳ STEP 3: 创建数据库集合    [进行中]
⏳ STEP 4: 打开游戏测试
⏳ STEP 5: 验证功能正常
```

---

## ✨ 完成提示

当你在云开发控制台的数据库菜单中看到这3个集合时，说明 STEP 3 完成了：

```
集合列表:
  ✓ achievements
  ✓ leaderboard
  ✓ user_data
```

**恭喜！你已完成一半了！** 🎉

现在可以继续 STEP 4：打开游戏测试

---

*STEP 3 完整指南版本: 1.0*
*最后更新: 2025-12-12*
*状态: ✅ 可立即使用*
